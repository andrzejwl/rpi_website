<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Dynamic sensor data</title>
  <meta name="description" content="HC-SR04">
  <meta name="author" content="Andrzej WÅ‚odarczyk">

  <script src="https://code.jquery.com/jquery-3.5.0.js" integrity="sha256-r/AaFHrszJtwpe+tHyNi/XCfMxYpbsRg2Uqn0x3s2zc=" crossorigin="anonymous"></script>

  	<style>
  		.progress-bar{
  			width: 100%;
  			height: 200px;
  			border: 1px solid black;
  			position: relative;
  		}

  		.progress-bar-fill{
  			height: 100%;
  			background: lightblue;
  			transition: width 0.5s;
  		}

  		.result{
  			position: absolute;
  			width: 100%;
  			height: 100%;

  			display: flex;
  			align-items: center;
  			justify-content: center;

  			font-weight: bold;
  			font-size: 40px;
  			font-family: sans-serif;
  		}

	</style>

</head>

<body>

  	<div class="progress-bar">
  		<div class="result" id ="sensor-data"></div>
  		<div class = "progress-bar-fill"></div>
    </div>


	<script>
	  	
	  	

	  	class ProgressBar{
	  		constructor(element, intial_value){
	  			this.value_elem = element.querySelector('.result');
	  			this.fill_elem = element.querySelector('.progress-bar-fill');
	  			
	  			this.set_value(intial_value);
	  		}

	  		set_value(new_value){
	  			this.value_scaled = new_value * 0.25; //100% of the bar is actually 400cm, scaled for better visibility
				this.value = new_value;

	  			if (this.value_scaled < 0) {
	  				this.value_scaled = 0;
	  			}

	  			if (this.value_scaled > 100) {
	  				this.value_scaled = 100;
	  			}

	  			
	  			this.update();
	  		}

	  		update(){
	  			const percentage = this.value_scaled + '%';

	  			this.fill_elem.style.width = percentage;
	  			this.value_elem.textContent = this.value + 'cm';
	  		}
	  	}

	  	bar = new ProgressBar(document.querySelector('.progress-bar'), 200);


	  	var hostname = document.location.origin;
	  	var interval = 1000;

	  	function getData() {
	  		$.ajax({
	  			url: hostname+"/data.txt",
			        type: "GET",
			        dataType : "text",
			        success: function(data){
			        	
			        	d = document.getElementById('sensor-data');
				        d.innerHTML = data;
				        bar.set_value(data);

			        	setTimeout(function(){
			        		getData();
			        	}, interval);
			        }
			});
	  	}

	  	getData();

    </script>
</body>
</html>